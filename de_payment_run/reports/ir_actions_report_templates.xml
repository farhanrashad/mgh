<?xml version="1.0" encoding="utf-8"?>
<odoo>
<template id="report_payment_run_document">
    <t t-call="web.external_layout">
        <div class="page">
            <div class="oe_structure"/>
                
            <h2 class="mt-4">
                <span t-field="o.name"/>
            </h2>

            <div class="row mt-4 mb-2" id="informations">
                <div t-if="o.partner_type" class="col-auto col-3 mw-100 mb-2" name="partner_type">
                    <strong>Partner Type:</strong><br/>
                    <span class="m-0" t-field="o.partner_type"/>
                </div>
                <div t-if="o.payment_type" class="col-auto col-3 mw-100 mb-2" name="payment_type">
                    <strong>Payment Type:</strong><br/>
                    <span t-if="o.payment_type == 'outbound'">Send Money</span>
                    <span t-elif="o.payment_type == 'inbound'">Receive Money</span>
                </div>
                
                <div t-if="o.date" class="col-auto col-3 mw-100 mb-2" name="run_date">
                    <strong>Run Date:</strong><br/>
                    <span class="m-0" t-field="o.date" t-options='{"widget": "date"}'>2023-12-31</span>
                </div>
                <div t-if="o.date_next_run" class="col-auto col-3 mw-100 mb-2" name="next_run_date">
                    <strong>Next Run Date:</strong><br/>
                    <span class="m-0" t-field="o.date_next_run" t-options='{"widget": "date"}'>2023-12-31</span>
                </div>
                
            </div>
            <div class="row mt-4 mb-2" id="informations">
                <div t-if="o.date_accounting" class="col-auto col-3 mw-100 mb-2" name="posting_date">
                    <strong>Posting Date:</strong><br/>
                    <span class="m-0" t-field="o.date_accounting" t-options='{"widget": "date"}'>2023-12-31</span>
                </div>
                
                <div t-if="o.company_id" class="col-auto col-3 mw-100 mb-2" name="company_id">
                    <strong>Company:</strong><br/>
                    <span class="m-0" t-field="o.company_id"/>
                </div>

                <div t-if="o.state" class="col-auto col-3 mw-100 mb-2" name="state">
                    <strong>State:</strong><br/>
                    <span class="m-0" t-field="o.state"/>
                </div>
            </div>

            <div class="oe_structure"></div>
            <table class="table table-sm o_main_table table-border bordered mt-4">
                <!-- In case we want to repeat the header, remove "display: table-row-group" -->
                <thead style="display: table-row-group">
                    <tr>
                        <th name="th_doc_ref" class="text-start">Doc. Ref</th>
                        <th name="th_doc_ref" class="text-start">Date</th>
                        <th name="th_doc_ref" class="text-start">Due Date</th>
                        <th name="th_partner" class="text-end">Partner</th>
                        <th name="th_type" class="text-end">Type</th>
                        <th name="th_journal" class="text-end">Journal</th>
                        <th name="th_journal" class="text-end">Bank</th>
                        <th name="th_amount" class="text-end">
                            <span>Amount</span>
                        </th>
                    </tr>
                </thead>
                <tbody class="line_tbody">
                    <t t-set="current_subtotal" t-value="0"/>
                    <t t-foreach="o.line_ids" t-as="line">
                        <t t-set="current_subtotal" t-value="current_subtotal + line.amount_to_pay"/>
                        <tr>
                            <td name="td_move_name"><span t-field="line.move_id.name"/></td>
                            <td name="td_invoice_date"><span class="m-0" t-field="line.move_id.invoice_date" t-options='{"widget": "date"}'>2023-12-31</span></td>
                            <td name="td_invoice_date_due"><span class="m-0" t-field="line.move_id.invoice_date_due" t-options='{"widget": "date"}'>2023-12-31</span></td>
                            <td name="td_partner"><span t-field="line.move_id.partner_id.name"/></td>
                            <td name="td_move_type"><span t-field="line.move_id.move_type"/></td>
                            <td name="td_journal"><span t-field="line.move_id.journal_id.name"/></td>
                            <td name="td_bank"><span t-field="line.payment_journal_id.name"/></td>
                            <td name="td_amount_pay" class="text-end">
                                <span t-field="line.amount_to_pay"/>                             
                            </td>   
                        </tr>
                    </t>
                    <tr class="is-subtotal text-end">
                            <td name="td_section_total" colspan="99">
                                <strong class="mr16">Total</strong>
                                <span t-esc="current_subtotal"
                                    t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'
                                    />
                                
                            </td>
                    </tr>
                </tbody>
            </table>
            <div class="clearfix" name="so_total_summary">
                <div id="total" class="row" name="total">
                    <div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ms-auto">
                        <table class="table table-sm o_main_table table-border bordered mt-4">
                            <!-- Table header -->
                            <thead style="display: table-row-group">
                                <tr>
                                    <th>Bank</th>
                                    <th>Total Amount</th>
                                </tr>
                            </thead>
                            <tbody class="line_tbody">
                                <t t-set="journal_totals" t-value="{}"/> <!-- Dictionary to store journal ID totals -->
                                <t t-set="bank_ids" t-value="o.line_ids.mapped('payment_journal_id')"/>
                                
                                <!-- Summary rows for each journal ID -->
                                <t t-foreach="bank_ids" t-as="bank">
                                    <tr class="is-subtotal text-end">
                                        <td >
                                            <strong><span t-esc="bank.name"/></strong>
                                        </td>
                                        <td>
                                            <span
                                                t-esc="sum(o.line_ids.filtered(lambda x:x.payment_journal_id.id == bank.id).mapped('amount_to_pay'))"
                                            t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'
                                            />                                            
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="oe_structure"></div>
        </div>
    </t>
</template>

<template id="report_payment_run">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="de_payment_run.report_payment_run_document" />
                </t>
            </t>
    </template>


</odoo>
